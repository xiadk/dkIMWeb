<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="main.js" type="text/javascript"></script>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://unpkg.com/qiniu-js@2.2.2/dist/qiniu.min.js"></script>
    <style type='text/css'>

    </style>
    <title>我爱奶茶</title>
</head>
<body>
<input type="text" id="commit"/>
<input type="button" id="b1" value="客户端1" onclick="c()"/>
<br>
<input type="text" id="commit2"/>
<input type="button" id="b2" value="异步请求" onclick="d()"/>
<input type="button" id="b3" value="关闭请求" onclick="e()"/>

<a mm-action-track="" track-type="['click']" ng-click="sendClick($event)" track-opt="{'target':'发文件'}" class="web_wechat_pic js_fileupload ng-isolate-scope webuploader-container" ng-hide="noflash" href="javascript:;" title="图片和文件">
    <div class="webuploader-pick"></div>
    <div id="rt_rt_1cca4fghl1kp61gj25oq1h92kqv8" style="position: absolute; top: 0px; left: 0px; width: 30px; height: 30px; overflow: hidden; bottom: auto; right: auto;"><input type="file" name="file" class="webuploader-element-invisible" multiple="multiple"><label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label></div>
</a>
　　
<progress id="progress" min="0" max="100" value="0">0</progress>

<form method="post" action="http://upload-z2.qiniup.com" id="uploadForm"
      enctype="multipart/form-data">
    <input name="key" type="hidden" value="<resource_key>">
    <input name="x:<custom_name>" type="hidden" value="<custom_value>">
    <input name="token" type="hidden" value="<upload_token>">
    <input name="crc32" type="hidden"/>
    <input name="accept" type="hidden"/>
    <input name="file" id="file" type="file"/>
</form>

<script type="text/javascript">
    var accessKey = 'vE4qS1_PCT25dzaVB9ynIHmHvUHvW_zB_dqlB5SU';
    var secretKey = 'JdbREEWbIS8P0XwPWmphed-1LYQ6PeQRkji1GdFK';
    $("#uploadForm").change(function () {
        var file = $('#uploadForm')[0];
        var key = $('#uploadForm')[0].name;
        var scope = 'my-bucket:sunflower.jpg';
        var options = {
            scope: scope,
            expires: 7200
        };
        var putPolicy = new qiniu.rs.PutPolicy(options);
        var uploadToken = putPolicy.uploadToken(mac);
        console.log(file + ";" + key + ":"+uploadToken);
        var observable = qiniu.upload(file, key, uploadToken, putExtra, config);
        var observer = {
            next(res) {
                console.log("本次上传的总量控制信息:" + res.total.total);
            },
            error(err) {
                console.log("上传失败");
            },
            complete(res) {
                console.log("上传成功");
            }
        }
        var subscription = observable.subscribe(observer);
    });
    /*var formData = new FormData();
formData.append("file", document.getElementById('file').files[0]);
formData.append("token", token_value);

$.ajax({
    url: "/uploadurl",
    type: "POST",
    data: formData,
    processData: false, // 不要对data参数进行序列化处理，默认为true
    contentType: false, // 不要设置Content-Type请求头，因为文件数据是以 multipart/form-data 来编码
    xhr: function(){
        myXhr = $.ajaxSettings.xhr();
        if(myXhr.upload){
          myXhr.upload.addEventListener('progress',function(e) {
            if (e.lengthComputable) {
              var percent = Math.floor(e.loaded/e.total*100);
              if(percent <= 100) {
                $("#J_progress_bar").progress('set progress', percent);
                $("#J_progress_label").html('已上传：'+percent+'%');
              }
              if(percent >= 100) {
                $("#J_progress_label").html('文件上传完毕，请等待...');
                $("#J_progress_label").addClass('success');
              }
            }
          }, false);
        }
        return myXhr;
    },
    success: function(res){
        // 请求成功
    },
    error: function(res) {
        // 请求失败
        console.log(res);
    }
});*/
</script>
</body>

</html>